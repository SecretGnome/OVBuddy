<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVBuddy Terminal Interface</title>
    <link rel="stylesheet" href="/static/css/terminal.css" id="themeStylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="terminal-header">
            <h1 class="terminal-title">OVBuddy Terminal Interface</h1>
            <p class="terminal-subtitle">System Configuration & Management Console</p>

            <!-- Theme Toggle Button -->
            <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                <span id="themeIcon">☀️</span>
                <span id="themeText">Bright Theme</span>
            </button>
        </div>

        <!-- Message Display -->
        <div id="message" class="message"></div>

        <!-- Restart Snackbar -->
        <div id="restartSnackbar" class="snackbar" style="display: none;">
            <span id="restartSnackbarText">Configuration changed. Please restart the ovbuddy service for changes to take effect.</span>
            <button id="restartServiceButton" class="snackbar-button" onclick="restartServiceFromSnackbar()">Restart Service</button>
        </div>

        <!-- Configuration Section -->
        <div class="terminal-window">
            <div class="terminal-window-header">
                <h2 class="terminal-window-title">config.json</h2>
                <div class="terminal-window-controls">
                    <span class="terminal-control close"></span>
                    <span class="terminal-control minimize"></span>
                    <span class="terminal-control maximize"></span>
                </div>
            </div>
            <div class="terminal-window-body">
                <form id="configForm">
                    <div class="form-group">
                        <label for="stations">Stations (one per line)</label>
                        <textarea id="stations" name="stations" placeholder="Zürich Saalsporthalle&#10;Zürich, Saalsporthalle"></textarea>
                        <div class="help-text">Enter station names, one per line</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="lines">Lines (comma-separated)</label>
                        <input type="text" id="lines" name="lines" placeholder="S4, T13, T5">
                        <div class="help-text">Enter line numbers separated by commas</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="refresh_interval">Refresh Interval (seconds)</label>
                        <input type="number" id="refresh_interval" name="refresh_interval" min="1" step="1">
                        <div class="help-text">How often to update the display</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="qr_code_display_duration">QR Code Display Duration (seconds)</label>
                        <input type="number" id="qr_code_display_duration" name="qr_code_display_duration" min="0" step="1">
                        <div class="help-text">How long to show QR code on startup (0 to skip)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="destination_prefixes_to_remove">Destination Prefixes to Remove (one per line)</label>
                        <textarea id="destination_prefixes_to_remove" name="destination_prefixes_to_remove" placeholder="Zurich &#10;Zurich, &#10;Zürich "></textarea>
                        <div class="help-text">Prefixes to remove from destination names</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="destination_exceptions">Destination Exceptions (comma-separated)</label>
                        <input type="text" id="destination_exceptions" name="destination_exceptions" placeholder="HB, Hbf">
                        <div class="help-text">Destinations that should never have prefixes removed</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="max_departures">Max Departures</label>
                        <input type="number" id="max_departures" name="max_departures" min="1" max="20" step="1">
                        <div class="help-text">Maximum number of connections to display</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="inverted" name="inverted">
                            Inverted Display (white text on black background)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="flip_display" name="flip_display">
                            Flip Display (rotate 180 degrees)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="use_partial_refresh" name="use_partial_refresh">
                            Use Partial Refresh (less flashing, may have ghosting)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto_update" name="auto_update">
                            Auto-update on startup (automatically install updates when available)
                        </label>
                        <div class="help-text">When enabled, the system will automatically update and restart when a new version is available</div>
                    </div>
                    
                    <button type="submit">Save Configuration</button>
                </form>
            </div>
        </div>

        <!-- Service Management Section -->
        <div class="terminal-window">
            <div class="terminal-window-header">
                <h2 class="terminal-window-title">systemctl status</h2>
                <div class="terminal-window-controls">
                    <span class="terminal-control close"></span>
                    <span class="terminal-control minimize"></span>
                    <span class="terminal-control maximize"></span>
                </div>
            </div>
            <div class="terminal-window-body">
                <div id="servicesSection">
                    <div id="servicesStatus">
                        <p style="text-align: center;">Loading service status...</p>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" onclick="refreshServicesStatus()" class="secondary">Refresh Status</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- WiFi Management Section -->
        <div class="terminal-window">
            <div class="terminal-window-header">
                <h2 class="terminal-window-title">iwconfig</h2>
                <div class="terminal-window-controls">
                    <span class="terminal-control close"></span>
                    <span class="terminal-control minimize"></span>
                    <span class="terminal-control maximize"></span>
                </div>
            </div>
            <div class="terminal-window-body">
                <div id="wifiSection">
                    <div id="wifiStatus" class="wifi-status">
                        <strong>Status:</strong> <span id="wifiStatusText">Loading...</span><br>
                        <span id="wifiDetails"></span>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" id="scanButton" class="secondary" onclick="scanNetworks()">Scan for Networks</button>
                        <button type="button" id="refreshStatusButton" onclick="refreshWifiStatus()">Refresh Status</button>
                    </div>
                    
                    <div id="networkListContainer" style="display: none;">
                        <div class="form-group">
                            <label>Available Networks</label>
                            <div id="networkList" class="network-list"></div>
                        </div>
                        
                        <div class="form-group" id="passwordGroup" style="display: none;">
                            <label for="wifiPassword">Password (leave empty for open networks)</label>
                            <input type="password" id="wifiPassword" name="wifiPassword" placeholder="Enter WiFi password">
                        </div>
                        
                        <div class="form-group">
                            <button type="button" id="connectButton" onclick="connectToNetwork()" disabled>Connect</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shutdown Section -->
        <div class="terminal-window">
            <div class="terminal-window-header">
                <h2 class="terminal-window-title">shutdown</h2>
                <div class="terminal-window-controls">
                    <span class="terminal-control close"></span>
                    <span class="terminal-control minimize"></span>
                    <span class="terminal-control maximize"></span>
                </div>
            </div>
            <div class="terminal-window-body">
                <div id="shutdownSection">
                    <p style="margin-bottom: 15px;">Stop the ovbuddy service and clear the display. Optionally upload an image to display after clearing.</p>
                    
                    <div class="form-group">
                        <label for="shutdownImage">Optional: Upload image to display (JPG/PNG)</label>
                        <input type="file" id="shutdownImage" name="shutdownImage" accept="image/jpeg,image/jpg,image/png">
                        <div class="help-text">Image will be resized and centered on the display</div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" id="shutdownButton" onclick="shutdownDisplay()" class="danger">Shutdown & Clear Display</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 12px;">
            <p>OVBuddy Web Interface | System Online | Press Cmd + W to exit</p>
            <div id="versionInfo" style="margin-top: 10px; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 4px; display: inline-block;">
                <span id="versionText">Loading version...</span>
            </div>
            <p style="margin-top: 10px;">
                Want to contribute? Check out the project on 
                <a href="https://github.com/SecretGnome/OVBuddy" target="_blank" style="color: var(--primary-color); text-decoration: none;">GitHub</a>
            </p>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>

